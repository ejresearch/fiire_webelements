<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>FIIRE Studio - AI Sample & Loop Generator</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        "brand": "#E85002",
        "brand-hover": "#F16001",
        "bg": "#1A1A1A",
        "panel": "#232323",
        "surface": "#2D2D2D",
        "surface-hi": "#3D3D3D",
        "border": "#3D3D3D",
        "border-light": "#4A4A4A",
        "txt": "#D4D4D4",
        "txt-muted": "#999999",
        "txt-dim": "#666666",
        "dk-gray": "#3D3D3D",
      },
      fontFamily: {
        "display": ["Space Grotesk", "system-ui", "sans-serif"],
        "mono": ["'SF Mono'", "'Consolas'", "monospace"],
      },
      fontSize: {
        "xxs": ["10px", { lineHeight: "14px" }],
        "micro": ["9px", { lineHeight: "12px" }],
      },
    },
  },
}
</script>
<link rel="stylesheet" href="css/shared.css"/>
</head>
<body class="antialiased">
<div class="flex h-screen overflow-hidden">

<!-- ==================== SIDEBAR ==================== -->
<aside class="w-[200px] flex-shrink-0 border-r border-border flex flex-col bg-panel z-10">
  <a href="home.html" class="px-3 py-2 flex items-center cursor-pointer">
    <img src="logo.png" alt="FIIRE" class="h-12 w-auto" />
  </a>

  <!-- Project Switcher -->
  <div class="px-2 pb-2 relative">
    <button id="project-switcher" class="w-full flex items-center gap-2 px-2 py-1.5 bg-surface border border-border hover:border-border-light transition-colors text-left" onclick="toggleProjectDropdown()">
      <div class="w-5 h-5 bg-brand/10 flex items-center justify-center flex-shrink-0">
        <span class="material-symbols-outlined text-brand text-[12px]">folder</span>
      </div>
      <div class="flex-1 min-w-0">
        <p id="project-name" class="text-[11px] font-bold truncate">My Project</p>
        <p id="project-count" class="text-[9px] text-txt-dim">0 samples</p>
      </div>
      <span class="material-symbols-outlined text-txt-dim text-[14px] flex-shrink-0" id="project-chevron">expand_more</span>
    </button>

    <!-- Project dropdown -->
    <div id="project-dropdown" class="hidden absolute left-2 right-2 top-full mt-1 bg-panel border border-border z-50 overflow-hidden">
      <div class="max-h-64 overflow-y-auto py-1" id="project-list"></div>
      <div class="border-t border-border p-1.5">
        <div id="new-project-row" class="flex items-center gap-1">
          <button class="flex-1 flex items-center gap-1.5 px-2 py-1 text-[11px] text-brand hover:bg-surface transition-colors font-medium" onclick="showNewProjectInput()">
            <span class="material-symbols-outlined text-[14px]">add</span> New Project
          </button>
        </div>
        <div id="new-project-input-row" class="hidden flex items-center gap-1">
          <input id="new-project-input" class="flex-1 bg-bg border border-border px-2 py-1 text-[11px] text-txt placeholder:text-txt-dim" placeholder="Project name..." onkeydown="if(event.key==='Enter')confirmNewProject(); if(event.key==='Escape')cancelNewProject();" />
          <button class="p-1 text-emerald-400 hover:bg-surface" onclick="confirmNewProject()">
            <span class="material-symbols-outlined text-[14px]">check</span>
          </button>
          <button class="p-1 text-txt-dim hover:bg-surface" onclick="cancelNewProject()">
            <span class="material-symbols-outlined text-[14px]">close</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <nav class="flex-1 px-2 py-1 flex flex-col gap-0">
    <a href="home.html" class="nav-link flex items-center gap-2 px-2 py-1" data-page="home">
      <span class="material-symbols-outlined text-[16px]">home</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Home</span>
    </a>
    <a href="sounddna.html" class="nav-link flex items-center gap-2 px-2 py-1" data-page="sounddna">
      <span class="material-symbols-outlined text-[16px]">fingerprint</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Sound DNA</span>
    </a>
    <a href="studio.html" class="nav-link flex items-center gap-2 px-2 py-1" data-page="studio">
      <span class="material-symbols-outlined text-[16px]">music_note</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Studio</span>
    </a>
    <button onclick="openSettingsModal()" class="nav-link flex items-center gap-2 px-2 py-1 w-full text-left">
      <span class="material-symbols-outlined text-[16px]">settings</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Settings</span>
    </button>
  </nav>
  <div class="p-2 border-t border-border">
    <button onclick="openNextEmptySlot()" class="w-full flex items-center justify-center gap-1 py-1.5 bg-brand hover:bg-brand-hover text-txt font-bold text-[11px] uppercase transition-all">
      <span class="material-symbols-outlined text-[14px]">add</span>
      New Sample
    </button>
  </div>
</aside>

<!-- ==================== MAIN CONTENT ==================== -->
<div class="flex-1 flex flex-col min-w-0 overflow-hidden">

<!-- ===== TRANSPORT BAR ===== -->
<div id="transport-bar" class="flex items-center gap-3 px-3 py-1 border-b border-border bg-panel flex-shrink-0">
  <div class="flex items-center gap-1">
    <button id="tl-stop" class="transport-btn w-7 h-7 flex items-center justify-center" onclick="timelineStop()">
      <span class="material-symbols-outlined text-txt-muted text-[14px]">stop</span>
    </button>
    <button id="tl-play" class="transport-btn w-7 h-7 flex items-center justify-center" onclick="timelinePlayPause()">
      <span class="material-symbols-outlined text-brand text-[14px]">play_arrow</span>
    </button>
    <button id="tl-record" class="transport-btn w-7 h-7 flex items-center justify-center" onclick="toggleRecording()" title="Record (R)">
      <span class="material-symbols-outlined text-[14px]" style="color:#EF4444;">fiber_manual_record</span>
    </button>
    <button id="tl-loop" class="transport-btn w-7 h-7 flex items-center justify-center" onclick="timelineToggleLoop()">
      <span class="material-symbols-outlined text-txt-dim text-[14px]">loop</span>
    </button>
  </div>
  <div class="w-px h-5 bg-border"></div>
  <div class="flex items-center gap-1.5">
    <span class="section-label">BPM</span>
    <input id="tl-bpm" type="number" class="ab-input w-14 h-6 text-center text-brand font-mono text-[12px]" value="120" min="60" max="300" onchange="setTimelineBPM(this.value)"/>
  </div>
  <div class="flex items-center gap-1">
    <span class="section-label">SIG</span>
    <select id="tl-sig" class="ab-select h-6 text-[10px]" onchange="setTimelineSig(this.value)">
      <option value="4/4">4/4</option>
      <option value="3/4">3/4</option>
      <option value="6/8">6/8</option>
    </select>
  </div>
  <div class="w-px h-5 bg-border"></div>
  <div class="lcd px-2 py-0.5 bg-bg border border-border">
    <span id="tl-position" class="text-[11px] text-brand font-mono">1.1.0</span>
  </div>
  <div class="flex items-center gap-1 ml-auto">
    <span class="section-label">SNAP</span>
    <button id="tl-snap" class="param-chip active text-[9px]" onclick="cycleSnap()">1 BAR</button>
  </div>
  <div class="w-px h-5 bg-border"></div>
  <div class="flex items-center gap-1">
    <button onclick="toggleMute()" class="text-txt-muted hover:text-txt"><span id="volume-icon" class="material-symbols-outlined text-[14px]">volume_up</span></button>
    <input id="volume-slider" type="range" min="0" max="100" value="66" class="w-12 range-slider" oninput="setVolume(this.value)"/>
  </div>
  <div class="master-meter flex items-center gap-0.5 h-5">
    <div class="master-meter-bar"><div id="master-meter-l" class="master-meter-fill"></div></div>
    <div class="master-meter-bar"><div id="master-meter-r" class="master-meter-fill"></div></div>
  </div>
</div>

<!-- ===== API KEY WARNING ===== -->
<div id="api-key-warning" class="hidden flex items-center gap-1.5 px-3 py-1 bg-amber-500/8 border-b border-amber-500/15 text-[10px] flex-shrink-0">
  <span class="material-symbols-outlined text-amber-400 text-[12px]">warning</span>
  <span class="text-amber-300">No API key — synthetic placeholders.</span>
  <button class="text-amber-400 hover:text-amber-300 underline font-medium" onclick="openSettingsModal()">Set key</button>
</div>

<!-- ===== THREE-SECTION WORKSPACE ===== -->
<div class="flex-1 flex flex-col min-h-0 overflow-hidden">

  <!-- ===== SECTION 1: BASE SAMPLES ===== -->
  <div id="base-samples-section" class="flex-shrink-0 bg-panel border-b border-border" style="height: 180px;">
    <div class="flex items-center justify-between px-3 py-1 border-b border-border">
      <span class="section-label">BASE SAMPLES</span>
      <div class="flex items-center gap-2">
        <span id="base-count" class="text-[9px] text-txt-dim font-mono">0 / 12</span>
        <button class="text-txt-dim hover:text-txt transition-colors" onclick="triggerAudioImport()" title="Import audio files">
          <span class="material-symbols-outlined text-[14px]">upload</span>
        </button>
      </div>
    </div>
    <div id="base-samples-grid" class="flex gap-2 p-2 overflow-x-auto h-[calc(100%-28px)] no-scrollbar"></div>
  </div>

  <!-- Resize handle -->
  <div class="resize-handle-h" data-resize="base-samples"></div>

  <!-- ===== SECTION 2: SAMPLE BAR ===== -->
  <div id="sample-bar-section" class="flex-shrink-0 bg-panel border-b border-border h-[48px]">
    <div class="flex items-center h-full px-2 gap-1 overflow-x-auto no-scrollbar">
      <span class="section-label mr-1 flex-shrink-0">RACK</span>
      <div id="sample-bar-slots" class="flex items-center gap-1 h-full"></div>
      <div id="bar-empty" class="flex items-center gap-1 text-txt-dim text-[9px] ml-1">
        <span class="material-symbols-outlined text-[12px]">info</span>
        <span>Favorites &amp; recent samples appear here</span>
      </div>
    </div>
  </div>

  <!-- ===== SECTION 3: TRACK TIMELINE ===== -->
  <div id="timeline-section" class="flex-1 flex flex-col min-h-0 bg-bg relative">
    <!-- Time ruler row -->
    <div class="flex flex-shrink-0">
      <div class="w-[140px] flex-shrink-0 bg-panel border-r border-b border-border"></div>
      <div id="time-ruler" class="flex-1 h-6 bg-panel border-b border-border overflow-hidden relative cursor-pointer" onclick="seekTimeline(event)">
        <canvas id="ruler-canvas" class="w-full h-full"></canvas>
        <div id="loop-region" class="absolute top-0 h-full bg-brand/10 border-x border-brand/30 hidden pointer-events-none"></div>
      </div>
    </div>
    <!-- Tracks area -->
    <div id="timeline-scroll" class="flex-1 flex min-h-0 overflow-hidden">
      <!-- Track headers -->
      <div id="track-headers" class="w-[140px] flex-shrink-0 bg-panel border-r border-border overflow-y-auto no-scrollbar">
        <div id="track-headers-list"></div>
        <button id="add-track-btn" class="w-full flex items-center gap-1 px-2 py-2 text-[10px] text-txt-dim hover:text-brand hover:bg-surface transition-colors border-b border-border" onclick="addTrack()">
          <span class="material-symbols-outlined text-[14px]">add</span> Add Track
        </button>
      </div>
      <!-- Track lanes + blocks -->
      <div id="track-content" class="flex-1 relative overflow-auto min-w-0" ondragover="handleTimelineDragOver(event)" ondrop="handleTimelineDrop(event)" ondragleave="hideDropIndicator()">
        <canvas id="timeline-grid-canvas" class="absolute inset-0 pointer-events-none"></canvas>
        <div id="track-lanes"></div>
        <div id="playhead" class="absolute top-0 bottom-0 w-px bg-brand z-10 pointer-events-none" style="left: 0; display: none;"></div>
        <div id="drop-indicator" class="drop-indicator hidden"></div>
      </div>
    </div>
    <!-- Timeline empty state -->
    <div id="timeline-empty" class="absolute inset-0 flex items-center justify-center pointer-events-none z-0" style="top: 24px;">
      <div class="text-center">
        <span class="material-symbols-outlined text-3xl text-txt-dim mb-2 block">playlist_add</span>
        <p class="text-txt-dim text-[11px]">Drag samples from above to create tracks</p>
      </div>
    </div>
  </div>
</div>

<!-- ===== INLINE GENERATION PANEL (popover) ===== -->
<div id="inline-gen-panel" class="hidden fixed z-50 bg-panel border border-border" style="width: 380px;">
  <div class="flex items-center justify-between px-3 py-1.5 border-b border-border">
    <span class="section-label">GENERATE</span>
    <button class="w-5 h-5 hover:bg-surface flex items-center justify-center text-txt-dim hover:text-txt transition-colors" onclick="closeInlineGeneration()">
      <span class="material-symbols-outlined text-[12px]">close</span>
    </button>
  </div>
  <div class="p-3 space-y-2">
    <!-- Reference upload -->
    <input id="ref-file-input" type="file" accept="audio/*" class="hidden" onchange="handleRefUpload(this)"/>
    <div id="ref-indicator" class="hidden flex items-center gap-1 mb-1">
      <div class="flex items-center gap-1.5 bg-brand/8 border border-brand/15 px-2 py-0.5">
        <span class="material-symbols-outlined text-brand text-[11px]">audio_file</span>
        <span id="ref-filename" class="text-[10px] text-txt font-medium truncate max-w-[160px]"></span>
        <span id="ref-duration" class="text-[10px] text-txt-muted"></span>
        <button class="text-txt-muted hover:text-txt flex items-center" onclick="playReference()" id="ref-play-btn">
          <span class="material-symbols-outlined text-[12px]">play_arrow</span>
        </button>
        <button class="text-txt-muted hover:text-red-400 flex items-center" onclick="removeReference()">
          <span class="material-symbols-outlined text-[11px]">close</span>
        </button>
      </div>
    </div>
    <!-- Prompt row -->
    <div class="flex items-center gap-1">
      <button class="flex-shrink-0 w-6 h-6 bg-bg border border-border hover:border-brand text-txt-dim hover:text-brand flex items-center justify-center transition-colors" onclick="document.getElementById('ref-file-input').click()" title="Upload reference">
        <span class="material-symbols-outlined text-[12px]">upload_file</span>
      </button>
      <input id="gen-prompt" class="flex-1 h-6 bg-bg border border-border px-2 text-[11px] text-txt placeholder:text-txt-dim focus:border-brand focus:outline-none transition-colors" placeholder="Describe your sound..." type="text" onkeydown="if(event.key==='Enter') generateSamples()"/>
    </div>
    <!-- Mode toggle -->
    <div class="flex items-center gap-1.5">
      <div class="flex h-5 items-center bg-bg border border-border flex-shrink-0">
        <label class="flex cursor-pointer h-full items-center justify-center px-2 has-[:checked]:bg-surface has-[:checked]:text-txt text-txt-dim text-[9px] font-bold uppercase tracking-wider transition-all">
          <span>LOOP</span>
          <input checked name="gen-mode" type="radio" value="loop" class="hidden" onchange="setGenerateMode('loop')"/>
        </label>
        <label class="flex cursor-pointer h-full items-center justify-center px-2 has-[:checked]:bg-surface has-[:checked]:text-txt text-txt-dim text-[9px] font-bold uppercase tracking-wider transition-all border-l border-border">
          <span>ONE-SHOT</span>
          <input name="gen-mode" type="radio" value="oneshot" class="hidden" onchange="setGenerateMode('oneshot')"/>
        </label>
      </div>
      <div id="instrument-chips" class="flex gap-0 flex-shrink-0">
        <button class="param-chip active" onclick="toggleChip(this, 'instrument-chips')">DRUMS</button>
        <button class="param-chip" onclick="toggleChip(this, 'instrument-chips')">BASS</button>
        <button class="param-chip" onclick="toggleChip(this, 'instrument-chips')">MELODIC</button>
        <button class="param-chip" onclick="toggleChip(this, 'instrument-chips')">PAD</button>
        <button class="param-chip" onclick="toggleChip(this, 'instrument-chips')">FX</button>
        <button class="param-chip" onclick="toggleChip(this, 'instrument-chips')">VOCAL</button>
      </div>
    </div>
    <!-- Loop params -->
    <div id="loop-params" class="flex items-center gap-2">
      <span class="section-label">BPM</span>
      <select id="bpm-input" class="ab-select h-5">
        <option value="" selected>&mdash;</option>
        <option>80</option><option>90</option><option>100</option><option>110</option>
        <option>120</option><option>130</option><option>140</option><option>150</option>
        <option>160</option><option>170</option><option>180</option><option>200</option>
      </select>
      <span class="section-label ml-1">KEY</span>
      <select id="key-select" class="ab-select h-5">
        <option value="auto" selected>&mdash;</option>
        <option>C</option><option>Cm</option><option>C#</option><option>C#m</option>
        <option>D</option><option>Dm</option><option>D#</option><option>D#m</option>
        <option>E</option><option>Em</option>
        <option>F</option><option>Fm</option><option>F#</option><option>F#m</option>
        <option>G</option><option>Gm</option><option>G#</option><option>G#m</option>
        <option>A</option><option>Am</option><option>A#</option><option>A#m</option>
        <option>B</option><option>Bm</option>
      </select>
      <span class="section-label ml-1">BARS</span>
      <div id="length-chips" class="flex gap-0">
        <button class="param-chip" onclick="setLength(2, this)">2</button>
        <button class="param-chip active" onclick="setLength(4, this)">4</button>
        <button class="param-chip" onclick="setLength(8, this)">8</button>
        <button class="param-chip" onclick="setLength(16, this)">16</button>
      </div>
    </div>
    <!-- One-shot params -->
    <div id="oneshot-params" class="hidden items-center gap-2">
      <span class="section-label">TUNING</span>
      <select id="tuning-select" class="ab-select h-5">
        <option>C2</option><option>C3</option><option>C4</option><option>C5</option>
        <option>D3</option><option>D4</option><option>E3</option><option>E4</option>
        <option>F3</option><option>F4</option><option>G3</option><option>G4</option>
        <option>A3</option><option>A4</option><option>B3</option><option>B4</option>
      </select>
      <span class="section-label ml-1">ATTACK</span>
      <div id="attack-chips" class="flex gap-0">
        <button class="param-chip active" onclick="toggleChip(this, 'attack-chips')">SNP</button>
        <button class="param-chip" onclick="toggleChip(this, 'attack-chips')">SFT</button>
        <button class="param-chip" onclick="toggleChip(this, 'attack-chips')">TRN</button>
        <button class="param-chip" onclick="toggleChip(this, 'attack-chips')">PUN</button>
      </div>
      <span class="section-label ml-1">TIMBRE</span>
      <div id="timbre-chips" class="flex gap-0">
        <button class="param-chip active" onclick="toggleChip(this, 'timbre-chips')">WRM</button>
        <button class="param-chip" onclick="toggleChip(this, 'timbre-chips')">BRT</button>
        <button class="param-chip" onclick="toggleChip(this, 'timbre-chips')">DRK</button>
        <button class="param-chip" onclick="toggleChip(this, 'timbre-chips')">MTL</button>
      </div>
    </div>
    <!-- Energy + Vars + Genre -->
    <div class="flex items-center gap-1.5">
      <span class="section-label">NRG</span>
      <div id="energy-chips" class="flex gap-0">
        <button class="param-chip" onclick="toggleChip(this, 'energy-chips')">LOW</button>
        <button class="param-chip active" onclick="toggleChip(this, 'energy-chips')">MID</button>
        <button class="param-chip" onclick="toggleChip(this, 'energy-chips')">HIGH</button>
      </div>
      <div class="w-px h-4 bg-border"></div>
      <span class="section-label">VARS</span>
      <div id="varcount-chips" class="flex gap-0">
        <button class="param-chip" onclick="setVarCount(1, this)">1</button>
        <button class="param-chip" onclick="setVarCount(2, this)">2</button>
        <button class="param-chip active" onclick="setVarCount(4, this)">4</button>
        <button class="param-chip" onclick="setVarCount(8, this)">8</button>
      </div>
    </div>
    <div class="flex items-center gap-1">
      <span class="section-label flex-shrink-0">GENRE</span>
      <div id="style-chips" class="flex gap-0 flex-1 overflow-x-auto no-scrollbar">
        <button class="param-chip" onclick="toggleMultiChip(this)">TRAP</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">BOOMBAP</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">HOUSE</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">TECHNO</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">DNB</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">AMBIENT</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">R&amp;B</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">LOFI</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">FUNK</button>
        <button class="param-chip" onclick="toggleMultiChip(this)">AFRO</button>
      </div>
    </div>
    <!-- Generate button -->
    <button id="gen-btn" class="w-full bg-brand hover:bg-brand-hover text-txt font-bold py-1.5 flex items-center justify-center gap-1 text-[11px] transition-all" onclick="generateSamples()">
      <span class="material-symbols-outlined text-[14px]">bolt</span>
      <span id="gen-btn-text">GENERATE</span>
    </button>
  </div>
  <!-- Variations area (within inline panel) -->
  <div id="inline-gen-variations" class="border-t border-border">
    <div id="gen-loading" class="hidden flex items-center gap-2 px-3 py-2">
      <div class="flex items-end gap-[1px]">
        <span class="gen-loading-bar"></span><span class="gen-loading-bar"></span><span class="gen-loading-bar"></span>
        <span class="gen-loading-bar"></span><span class="gen-loading-bar"></span><span class="gen-loading-bar"></span>
      </div>
      <span class="text-txt-muted text-[10px]">Generating...</span>
    </div>
    <div id="var-grid" class="max-h-[240px] overflow-y-auto"></div>
    <div id="gen-summary" class="hidden flex items-center justify-between px-3 py-1.5 border-t border-border"></div>
  </div>
</div>

<!-- ===== FX PANEL ===== -->
<div id="fx-panel" class="hidden fixed z-50 bg-panel border border-border" style="width: 280px; right: 16px; top: 80px; max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.5); border-radius: 3px;">
</div>

<!-- ===== CLICK OUTSIDE INLINE GEN OVERLAY ===== -->
<div id="inline-gen-backdrop" class="hidden fixed inset-0 z-40" onclick="closeInlineGeneration()"></div>

</div>

<div id="toast" class="toast"></div>

<!-- Confirm modal -->
<div id="confirm-modal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="bg-panel border border-border p-4 w-full max-w-sm animate-fadeIn">
    <h3 id="confirm-title" class="text-[13px] font-bold mb-1.5"></h3>
    <p id="confirm-msg" class="text-[11px] text-txt-muted mb-4"></p>
    <div class="flex gap-2">
      <button class="flex-1 py-1.5 bg-surface border border-border text-[11px] font-bold hover:bg-dk-gray transition-colors" onclick="closeModal()">Cancel</button>
      <button id="confirm-action" class="flex-1 py-1.5 bg-red-600 hover:bg-red-500 text-[11px] font-bold text-txt transition-colors">Confirm</button>
    </div>
  </div>
</div>

<!-- Import from Project modal -->
<div id="import-modal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="bg-panel border border-border w-full max-w-lg animate-fadeIn flex flex-col max-h-[80vh]">
    <div class="p-4 pb-3 border-b border-border">
      <h3 class="text-[13px] font-bold mb-2">Import from Project</h3>
      <select id="import-project-select" class="w-full ab-select px-2 py-1.5 text-[11px]" onchange="renderImportList()">
        <option value="">Select a project...</option>
      </select>
    </div>
    <div class="flex-1 overflow-y-auto p-3" id="import-sample-list">
      <p class="text-[11px] text-txt-dim text-center py-6">Select a project to see its samples</p>
    </div>
    <div class="p-3 border-t border-border flex items-center justify-between">
      <span class="text-[11px] text-txt-muted"><span id="import-selected-count">0</span> selected</span>
      <div class="flex gap-2">
        <button class="px-3 py-1.5 bg-surface border border-border text-[11px] font-bold hover:bg-dk-gray transition-colors" onclick="closeModal()">Cancel</button>
        <button id="import-btn" class="px-3 py-1.5 bg-brand hover:bg-brand-hover text-[11px] font-bold text-txt transition-colors" onclick="importSelectedSamples()">Import Selected</button>
      </div>
    </div>
  </div>
</div>

<!-- Settings modal -->
<div id="settings-modal" class="modal-overlay" onclick="if(event.target===this)closeSettingsModal()">
  <div class="settings-panel animate-fadeIn">
    <div class="settings-header">
      <span class="text-[12px] font-bold uppercase tracking-wider">Settings</span>
      <button class="settings-close" onclick="closeSettingsModal()">
        <span class="material-symbols-outlined text-[12px]">close</span>
      </button>
    </div>
    <div class="settings-body">
      <div class="settings-group">
        <label class="section-label">DISPLAY NAME</label>
        <p class="settings-hint">Shown in the greeting on the home page.</p>
        <div class="flex items-center gap-2">
          <input id="settings-display-name" type="text" class="settings-input flex-1" placeholder="Your name" />
          <button class="settings-btn-primary" onclick="saveDisplayName()">Save</button>
        </div>
      </div>
      <div class="settings-group">
        <label class="section-label">ELEVENLABS API KEY</label>
        <p class="settings-hint">Required for AI samples. Get a key at <a href="https://elevenlabs.io/developers" target="_blank" class="text-brand hover:underline">elevenlabs.io</a></p>
        <div class="relative">
          <input id="settings-api-key" type="password" class="settings-input w-full pr-8 font-mono" placeholder="xi_..." />
          <button class="absolute right-2 top-1/2 -translate-y-1/2 text-[#666] hover:text-[#999] transition-colors" onclick="toggleApiKeyVisibility()">
            <span class="material-symbols-outlined text-[13px]" id="api-key-eye">visibility_off</span>
          </button>
        </div>
        <div class="flex items-center gap-2 mt-2">
          <button id="api-test-btn" class="settings-btn-secondary" onclick="testApiKey()">
            <span class="material-symbols-outlined text-[11px]">bolt</span> <span id="api-test-label">Test</span>
          </button>
          <button class="settings-btn-primary" onclick="saveApiKey()">Save</button>
          <div id="api-status" class="flex items-center gap-1 ml-auto text-[10px]"></div>
        </div>
      </div>
      <div class="settings-group">
        <label class="section-label">CLAUDE API KEY</label>
        <p class="settings-hint">Optional — enables AI prompt refinement. Get a key at <a href="https://console.anthropic.com/" target="_blank" class="text-brand hover:underline">console.anthropic.com</a></p>
        <div class="relative">
          <input id="settings-claude-key" type="password" class="settings-input w-full pr-8 font-mono" placeholder="sk-ant-..." />
          <button class="absolute right-2 top-1/2 -translate-y-1/2 text-[#666] hover:text-[#999] transition-colors" onclick="toggleClaudeKeyVisibility()">
            <span class="material-symbols-outlined text-[13px]" id="claude-key-eye">visibility_off</span>
          </button>
        </div>
        <div class="flex items-center gap-2 mt-2">
          <button class="settings-btn-primary" onclick="saveClaudeKey()">Save</button>
          <div id="claude-key-status" class="flex items-center gap-1 ml-auto text-[10px]"></div>
        </div>
      </div>
      <div class="settings-group">
        <label class="section-label">LIBRARY</label>
        <p class="settings-hint">Export all samples in your library as WAV files.</p>
        <button class="settings-btn-secondary" onclick="exportAllSamples()">
          <span class="material-symbols-outlined text-[11px]">download</span> Export All
        </button>
      </div>
      <div class="settings-group">
        <label class="section-label">DATA</label>
        <p class="settings-hint">Clear all local data including samples, projects, and audio.</p>
        <button class="settings-btn-danger" onclick="clearAllDataConfirm()">
          <span class="material-symbols-outlined text-[11px]">delete_forever</span> Clear All Data
        </button>
      </div>
    </div>
  </div>
</div>
</div>
</div>

<script src="js/shared.js"></script>
<script src="js/studio.js"></script>
<script src="js/blaise.js"></script>
</body>
</html>
