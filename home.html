<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>FIIRE - Home</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        "brand": "#E85002",
        "brand-hover": "#F16001",
        "bg": "#1A1A1A",
        "panel": "#232323",
        "surface": "#2D2D2D",
        "surface-hi": "#3D3D3D",
        "border": "#3D3D3D",
        "border-light": "#4A4A4A",
        "txt": "#D4D4D4",
        "txt-muted": "#999999",
        "txt-dim": "#666666",
        "dk-gray": "#3D3D3D",
      },
      fontFamily: {
        "display": ["Space Grotesk", "system-ui", "sans-serif"],
        "mono": ["'SF Mono'", "'Consolas'", "monospace"],
      },
      fontSize: {
        "xxs": ["10px", { lineHeight: "14px" }],
        "micro": ["9px", { lineHeight: "12px" }],
      },
    },
  },
}
</script>
<link rel="stylesheet" href="css/shared.css"/>
</head>
<body class="antialiased">
<div class="flex h-screen overflow-hidden">

<!-- ==================== SIDEBAR ==================== -->
<aside class="w-[200px] flex-shrink-0 border-r border-border flex flex-col bg-panel z-10">
  <a href="home.html" class="px-3 py-2 flex items-center cursor-pointer">
    <img src="logo.png" alt="FIIRE" class="h-12 w-auto" />
  </a>

  <!-- Project Switcher -->
  <div class="px-2 pb-2 relative">
    <button id="project-switcher" class="w-full flex items-center gap-2 px-2 py-1.5 bg-surface border border-border hover:border-border-light transition-colors text-left" onclick="toggleProjectDropdown()">
      <div class="w-5 h-5 bg-brand/10 flex items-center justify-center flex-shrink-0">
        <span class="material-symbols-outlined text-brand text-[12px]">folder</span>
      </div>
      <div class="flex-1 min-w-0">
        <p id="project-name" class="text-[11px] font-bold truncate">My Project</p>
        <p id="project-count" class="text-[9px] text-txt-dim">0 samples</p>
      </div>
      <span class="material-symbols-outlined text-txt-dim text-[14px] flex-shrink-0" id="project-chevron">expand_more</span>
    </button>
    <div id="project-dropdown" class="hidden absolute left-2 right-2 top-full mt-1 bg-panel border border-border z-50 overflow-hidden">
      <div class="max-h-64 overflow-y-auto py-1" id="project-list"></div>
      <div class="border-t border-border p-1.5">
        <div id="new-project-row" class="flex items-center gap-1">
          <button class="flex-1 flex items-center gap-1.5 px-2 py-1 text-[11px] text-brand hover:bg-surface transition-colors font-medium" onclick="showNewProjectInput()">
            <span class="material-symbols-outlined text-[14px]">add</span> New Project
          </button>
        </div>
        <div id="new-project-input-row" class="hidden flex items-center gap-1">
          <input id="new-project-input" class="flex-1 bg-bg border border-border px-2 py-1 text-[11px] text-txt placeholder:text-txt-dim" placeholder="Project name..." onkeydown="if(event.key==='Enter')confirmNewProject(); if(event.key==='Escape')cancelNewProject();" />
          <button class="p-1 text-emerald-400 hover:bg-surface" onclick="confirmNewProject()">
            <span class="material-symbols-outlined text-[14px]">check</span>
          </button>
          <button class="p-1 text-txt-dim hover:bg-surface" onclick="cancelNewProject()">
            <span class="material-symbols-outlined text-[14px]">close</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <nav class="flex-1 px-2 py-1 flex flex-col gap-0">
    <a href="home.html" class="nav-link flex items-center gap-2 px-2 py-1" data-page="home">
      <span class="material-symbols-outlined text-[16px]">home</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Home</span>
    </a>
    <a href="sounddna.html" class="nav-link flex items-center gap-2 px-2 py-1" data-page="sounddna">
      <span class="material-symbols-outlined text-[16px]">fingerprint</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Sound DNA</span>
    </a>
    <a href="studio.html" class="nav-link flex items-center gap-2 px-2 py-1" data-page="studio">
      <span class="material-symbols-outlined text-[16px]">music_note</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Studio</span>
    </a>
    <button onclick="openSettingsModal()" class="nav-link flex items-center gap-2 px-2 py-1 w-full text-left">
      <span class="material-symbols-outlined text-[16px]">settings</span>
      <span class="text-[11px] font-medium uppercase tracking-wide">Settings</span>
    </button>
  </nav>
  <div class="p-2 border-t border-border">
    <a href="studio.html" class="w-full flex items-center justify-center gap-1 py-1.5 bg-brand hover:bg-brand-hover text-txt font-bold text-[11px] uppercase transition-all">
      <span class="material-symbols-outlined text-[14px]">add</span>
      New Session
    </a>
  </div>
</aside>

<!-- ==================== MAIN CONTENT ==================== -->
<div class="flex-1 flex flex-col min-w-0 overflow-hidden">

  <!-- Welcome banner (first-time users) -->
  <div id="welcome-banner" class="hidden"></div>

  <!-- Dashboard -->
  <div class="flex-1 overflow-y-auto px-6 py-5 space-y-5">

    <!-- Global Library -->
    <section>
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-sm font-bold uppercase tracking-wider text-txt-muted">Library</h2>
      </div>
      <!-- Library toolbar -->
      <div class="flex items-center gap-3 px-4 py-2 border border-border bg-panel mb-3">
        <div class="relative">
          <span class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-txt-dim text-[16px]">search</span>
          <input id="lib-search" class="ab-input pl-8 pr-3 text-[11px] w-[200px]" placeholder="Search..." type="text" oninput="renderLibrary({global:true})"/>
        </div>
        <div class="flex gap-1" id="lib-type-chips">
          <button class="param-chip active text-[10px]" onclick="setLibType('all', this)">ALL</button>
          <button class="param-chip text-[10px]" onclick="setLibType('loop', this)">LOOPS</button>
          <button class="param-chip text-[10px]" onclick="setLibType('oneshot', this)">1-SHOT</button>
          <button class="param-chip text-[10px]" onclick="setLibType('favorites', this)">FAV</button>
        </div>
        <div class="filter-popover-wrap">
          <button class="p-1 text-txt-muted hover:text-txt hover:bg-surface transition-colors relative" onclick="toggleFilterPopover(event)">
            <span class="material-symbols-outlined text-[16px]">tune</span>
            <span id="lib-filter-dot" class="filter-dot"></span>
          </button>
          <div id="lib-filter-popover" class="filter-popover">
            <div>
              <label>Source</label>
              <select id="lib-source-filter" class="ab-select text-[10px] py-1 px-2" onchange="renderLibrary({global:true}); updateFilterDot()">
                <option value="all">All Sources</option>
                <option value="dna">Sound DNA</option>
              </select>
            </div>
            <div>
              <label>Key</label>
              <select id="lib-key-filter" class="ab-select text-[10px] py-1 px-2" onchange="renderLibrary({global:true}); updateFilterDot()">
                <option value="all">All Keys</option>
                <option>C</option><option>Cm</option><option>D</option><option>Dm</option><option>E</option><option>Em</option>
                <option>F</option><option>Fm</option><option>G</option><option>Gm</option><option>A</option><option>Am</option><option>B</option><option>Bm</option>
              </select>
            </div>
            <div>
              <label>Sort</label>
              <select id="lib-sort" class="ab-select text-[10px] py-1 px-2" onchange="renderLibrary({global:true}); updateFilterDot()">
                <option value="recent">Newest</option>
                <option value="oldest">Oldest</option>
                <option value="name">Name A-Z</option>
                <option value="bpm">BPM</option>
              </select>
            </div>
          </div>
        </div>
        <div class="flex gap-1 ml-auto">
          <button id="lib-grid-btn" class="p-1 bg-surface border border-border text-brand" onclick="setLibView('grid')">
            <span class="material-symbols-outlined text-[16px]">grid_view</span>
          </button>
          <button id="lib-list-btn" class="p-1 text-txt-muted hover:text-txt hover:bg-surface transition-colors" onclick="setLibView('list')">
            <span class="material-symbols-outlined text-[16px]">view_list</span>
          </button>
        </div>
      </div>
      <!-- Library content -->
      <div class="pb-32">
        <div id="lib-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
        <div id="lib-list" class="hidden bg-panel border border-border overflow-hidden">
          <table class="w-full text-left border-collapse">
            <thead><tr class="bg-surface">

              <th class="px-4 py-3 text-xs font-semibold">Sample</th>
              <th class="px-4 py-3 text-xs font-semibold">Type</th>
              <th class="px-4 py-3 text-xs font-semibold">Key</th>
              <th class="px-4 py-3 text-xs font-semibold">BPM</th>
              <th class="px-4 py-3 text-xs font-semibold">Duration</th>
              <th class="px-4 py-3 text-xs font-semibold text-right">Actions</th>
            </tr></thead>
            <tbody id="lib-tbody" class="divide-y divide-border"></tbody>
          </table>
        </div>
        <div id="lib-empty" class="hidden text-center py-16 border-2 border-dashed border-border mt-4">
          <span class="material-symbols-outlined text-4xl text-txt-dim mb-3 block">library_music</span>
          <p class="text-txt-muted font-medium">No samples yet</p>
          <p class="text-txt-dim text-sm">Generate samples in the Studio to see them here.</p>
        </div>
      </div>
    </section>

  </div>
</div>

<!-- ==================== PLAYER BAR ==================== -->
<footer id="player-bar" class="fixed bottom-0 left-0 right-0 z-50 glass-effect border-t border-border px-3 py-1" style="display:none;">
  <div class="flex items-center gap-3">
    <div class="flex items-center gap-2 w-36 flex-shrink-0">
      <div class="w-7 h-7 bg-surface overflow-hidden flex-shrink-0">
        <canvas id="player-mini-waveform" width="28" height="28"></canvas>
      </div>
      <div class="min-w-0">
        <p id="player-title" class="font-bold text-[10px] truncate">Sample</p>
        <p id="player-meta" class="text-[9px] text-txt-muted truncate">120 BPM / Cm</p>
      </div>
    </div>
    <div class="flex-1 flex items-center gap-2">
      <button id="btn-play" class="w-7 h-7 bg-brand text-txt flex items-center justify-center hover:bg-brand-hover transition-all flex-shrink-0" onclick="togglePlayPause()">
        <span class="material-symbols-outlined text-[18px] fill-1">play_arrow</span>
      </button>
      <button id="btn-loop" class="text-txt-muted hover:text-txt transition-colors flex-shrink-0" onclick="toggleLoopPlayback()">
        <span class="material-symbols-outlined text-[14px]">loop</span>
      </button>
      <span id="player-current-time" class="text-[9px] font-mono text-txt-dim w-7 text-right flex-shrink-0">0:00</span>
      <div class="flex-1 h-6 relative cursor-pointer" onclick="seekSample(event)">
        <canvas id="player-waveform" class="w-full h-full"></canvas>
      </div>
      <span id="player-total-time" class="text-[9px] font-mono text-txt-dim w-7 flex-shrink-0">0:00</span>
    </div>
    <div class="flex items-center gap-2 flex-shrink-0">
      <button id="player-fav-btn" class="text-txt-muted hover:text-brand transition-colors" onclick="togglePlayerFav()">
        <span class="material-symbols-outlined text-[14px]">local_fire_department</span>
      </button>
      <button class="text-txt-muted hover:text-txt transition-colors" onclick="downloadSample(state.currentSample)">
        <span class="material-symbols-outlined text-[14px]">download</span>
      </button>
      <div class="flex items-center gap-1">
        <button onclick="toggleMute()" class="text-txt-muted hover:text-txt"><span id="volume-icon" class="material-symbols-outlined text-[14px]">volume_up</span></button>
        <input id="volume-slider" type="range" min="0" max="100" value="66" class="w-12 range-slider" oninput="setVolume(this.value)"/>
      </div>
    </div>
  </div>
</footer>

</div>

<div id="toast" class="toast"></div>

<!-- Confirm modal -->
<div id="confirm-modal" class="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="bg-panel border border-border p-4 w-full max-w-sm animate-fadeIn">
    <h3 id="confirm-title" class="text-[13px] font-bold mb-1.5"></h3>
    <p id="confirm-msg" class="text-[11px] text-txt-muted mb-4"></p>
    <div class="flex gap-2">
      <button class="flex-1 py-1.5 bg-surface border border-border text-[11px] font-bold hover:bg-dk-gray transition-colors" onclick="closeModal()">Cancel</button>
      <button id="confirm-action" class="flex-1 py-1.5 bg-red-600 hover:bg-red-500 text-[11px] font-bold text-txt transition-colors">Confirm</button>
    </div>
  </div>
</div>

<!-- Settings modal -->
<div id="settings-modal" class="modal-overlay" onclick="if(event.target===this)closeSettingsModal()">
  <div class="settings-panel animate-fadeIn">
    <div class="settings-header">
      <span class="text-[12px] font-bold uppercase tracking-wider">Settings</span>
      <button class="settings-close" onclick="closeSettingsModal()">
        <span class="material-symbols-outlined text-[12px]">close</span>
      </button>
    </div>
    <div class="settings-body">
      <div class="settings-group">
        <label class="section-label">DISPLAY NAME</label>
        <p class="settings-hint">Shown in the greeting on the home page.</p>
        <div class="flex items-center gap-2">
          <input id="settings-display-name" type="text" class="settings-input flex-1" placeholder="Your name" />
          <button class="settings-btn-primary" onclick="saveDisplayName()">Save</button>
        </div>
      </div>
      <div class="settings-group">
        <label class="section-label">ELEVENLABS API KEY</label>
        <p class="settings-hint">Required for AI samples. Get a key at <a href="https://elevenlabs.io/developers" target="_blank" class="text-brand hover:underline">elevenlabs.io</a></p>
        <div class="relative">
          <input id="settings-api-key" type="password" class="settings-input w-full pr-8 font-mono" placeholder="xi_..." />
          <button class="absolute right-2 top-1/2 -translate-y-1/2 text-[#666] hover:text-[#999] transition-colors" onclick="toggleApiKeyVisibility()">
            <span class="material-symbols-outlined text-[13px]" id="api-key-eye">visibility_off</span>
          </button>
        </div>
        <div class="flex items-center gap-2 mt-2">
          <button id="api-test-btn" class="settings-btn-secondary" onclick="testApiKey()">
            <span class="material-symbols-outlined text-[11px]">bolt</span> <span id="api-test-label">Test</span>
          </button>
          <button class="settings-btn-primary" onclick="saveApiKey()">Save</button>
          <div id="api-status" class="flex items-center gap-1 ml-auto text-[10px]"></div>
        </div>
      </div>
      <div class="settings-group">
        <label class="section-label">CLAUDE API KEY</label>
        <p class="settings-hint">Optional â€” enables AI prompt refinement. Get a key at <a href="https://console.anthropic.com/" target="_blank" class="text-brand hover:underline">console.anthropic.com</a></p>
        <div class="relative">
          <input id="settings-claude-key" type="password" class="settings-input w-full pr-8 font-mono" placeholder="sk-ant-..." />
          <button class="absolute right-2 top-1/2 -translate-y-1/2 text-[#666] hover:text-[#999] transition-colors" onclick="toggleClaudeKeyVisibility()">
            <span class="material-symbols-outlined text-[13px]" id="claude-key-eye">visibility_off</span>
          </button>
        </div>
        <div class="flex items-center gap-2 mt-2">
          <button class="settings-btn-primary" onclick="saveClaudeKey()">Save</button>
          <div id="claude-key-status" class="flex items-center gap-1 ml-auto text-[10px]"></div>
        </div>
      </div>
      <div class="settings-group">
        <label class="section-label">LIBRARY</label>
        <p class="settings-hint">Export all samples in your library as WAV files.</p>
        <button class="settings-btn-secondary" onclick="exportAllSamples()">
          <span class="material-symbols-outlined text-[11px]">download</span> Export All
        </button>
      </div>
      <div class="settings-group">
        <label class="section-label">DATA</label>
        <p class="settings-hint">Clear all local data including samples, projects, and audio.</p>
        <button class="settings-btn-danger" onclick="clearAllDataConfirm()">
          <span class="material-symbols-outlined text-[11px]">delete_forever</span> Clear All Data
        </button>
      </div>
    </div>
  </div>
</div>
</div>
</div>

<script src="js/shared.js"></script>
<script src="js/home.js"></script>
<script src="js/blaise.js"></script>
</body>
</html>
